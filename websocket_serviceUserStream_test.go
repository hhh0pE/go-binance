package binance

import (
	"testing"

	"log"

	"github.com/json-iterator/go"
	"github.com/json-iterator/go/extra"
)

func TestJsoniter(t *testing.T) {
	msg := []byte(`{"e":"outboundAccountInfo","E":1524984672572,"m":10,"t":10,"b":0,"s":0,"T":true,"W":true,"D":true,"u":1524984672564,"B":[{"a":"BTC","f":"0.01369160","l":"0.00000000"},{"a":"LTC","f":"0.00000000","l":"0.00000000"},{"a":"ETH","f":"0.00000000","l":"0.00000000"},{"a":"BNC","f":"0.00000000","l":"0.00000000"},{"a":"ICO","f":"0.00000000","l":"0.00000000"},{"a":"NEO","f":"0.00407000","l":"0.00000000"},{"a":"BNB","f":"0.00000000","l":"0.00000000"},{"a":"123","f":"0.00000000","l":"0.00000000"},{"a":"456","f":"0.00000000","l":"0.00000000"},{"a":"QTUM","f":"0.00680000","l":"0.00000000"},{"a":"EOS","f":"0.00000000","l":"0.00000000"},{"a":"SNT","f":"0.00000000","l":"0.00000000"},{"a":"BNT","f":"0.00000000","l":"0.00000000"},{"a":"GAS","f":"0.00949145","l":"0.00000000"},{"a":"BCC","f":"0.00000000","l":"0.00000000"},{"a":"BTM","f":"0.00000000","l":"0.00000000"},{"a":"USDT","f":"0.00000000","l":"0.00000000"},{"a":"HCC","f":"0.00000000","l":"0.00000000"},{"a":"HSR","f":"0.00000000","l":"0.00000000"},{"a":"OAX","f":"0.00000000","l":"0.00000000"},{"a":"DNT","f":"0.00000000","l":"0.00000000"},{"a":"MCO","f":"0.00000000","l":"0.00000000"},{"a":"ICN","f":"0.00000000","l":"0.00000000"},{"a":"ELC","f":"0.00000000","l":"0.00000000"},{"a":"PAY","f":"0.00000000","l":"0.00000000"},{"a":"ZRX","f":"0.00000000","l":"0.00000000"},{"a":"OMG","f":"0.00000000","l":"0.00000000"},{"a":"WTC","f":"0.00000000","l":"0.00000000"},{"a":"LRX","f":"0.00000000","l":"0.00000000"},{"a":"YOYO","f":"0.00000000","l":"0.00000000"},{"a":"LRC","f":"0.00000000","l":"0.00000000"},{"a":"LLT","f":"0.00000000","l":"0.00000000"},{"a":"TRX","f":"0.00000000","l":"0.00000000"},{"a":"FID","f":"0.00000000","l":"0.00000000"},{"a":"SNGLS","f":"0.00000000","l":"0.00000000"},{"a":"STRAT","f":"0.00000000","l":"0.00000000"},{"a":"BQX","f":"0.00000000","l":"0.00000000"},{"a":"FUN","f":"0.00000000","l":"0.00000000"},{"a":"KNC","f":"0.00000000","l":"0.00000000"},{"a":"CDT","f":"0.00000000","l":"0.00000000"},{"a":"XVG","f":"0.00000000","l":"0.00000000"},{"a":"IOTA","f":"0.45198400","l":"0.00000000"},{"a":"SNM","f":"0.00000000","l":"0.00000000"},{"a":"LINK","f":"0.00000000","l":"0.00000000"},{"a":"CVC","f":"0.00000000","l":"0.00000000"},{"a":"TNT","f":"0.00000000","l":"0.00000000"},{"a":"REP","f":"0.00000000","l":"0.00000000"},{"a":"CTR","f":"0.00000000","l":"0.00000000"},{"a":"MDA","f":"0.00000000","l":"0.00000000"},{"a":"MTL","f":"0.00000000","l":"0.00000000"},{"a":"SALT","f":"0.00000000","l":"0.00000000"},{"a":"NULS","f":"0.00000000","l":"0.00000000"},{"a":"SUB","f":"0.00000000","l":"0.00000000"},{"a":"STX","f":"0.00000000","l":"0.00000000"},{"a":"MTH","f":"0.00000000","l":"0.00000000"},{"a":"CAT","f":"0.00000000","l":"0.00000000"},{"a":"ADX","f":"0.00000000","l":"0.00000000"},{"a":"PIX","f":"0.00000000","l":"0.00000000"},{"a":"ETC","f":"0.00000000","l":"0.00000000"},{"a":"ENG","f":"0.00000000","l":"0.00000000"},{"a":"ZEC","f":"0.00000000","l":"0.00000000"},{"a":"AST","f":"0.00000000","l":"0.00000000"},{"a":"1ST","f":"0.00000000","l":"0.00000000"},{"a":"GNT","f":"0.00000000","l":"0.00000000"},{"a":"DGD","f":"0.00000000","l":"0.00000000"},{"a":"BAT","f":"0.00000000","l":"0.00000000"},{"a":"DASH","f":"0.00000000","l":"0.00000000"},{"a":"POWR","f":"0.00000000","l":"0.00000000"},{"a":"BTG","f":"0.00000000","l":"0.00000000"},{"a":"REQ","f":"0.00000000","l":"0.00000000"},{"a":"XMR","f":"0.00000000","l":"0.00000000"},{"a":"EVX","f":"0.00000000","l":"0.00000000"},{"a":"VIB","f":"0.00000000","l":"0.00000000"},{"a":"ENJ","f":"0.00000000","l":"0.00000000"},{"a":"VEN","f":"0.00000000","l":"0.00000000"},{"a":"CAG","f":"0.00000000","l":"0.00000000"},{"a":"EDG","f":"0.00000000","l":"0.00000000"},{"a":"ARK","f":"0.00000000","l":"0.00000000"},{"a":"XRP","f":"0.59000000","l":"0.00000000"},{"a":"MOD","f":"0.00000000","l":"0.00000000"},{"a":"AVT","f":"0.00000000","l":"0.00000000"},{"a":"STORJ","f":"0.00000000","l":"0.00000000"},{"a":"KMD","f":"0.00000000","l":"0.00000000"},{"a":"RCN","f":"0.00000000","l":"0.00000000"},{"a":"EDO","f":"0.00000000","l":"0.00000000"},{"a":"QASH","f":"0.00000000","l":"0.00000000"},{"a":"SAN","f":"0.00000000","l":"0.00000000"},{"a":"DATA","f":"0.00000000","l":"0.00000000"},{"a":"DLT","f":"0.00000000","l":"0.00000000"},{"a":"GUP","f":"0.00000000","l":"0.00000000"},{"a":"MCAP","f":"0.00000000","l":"0.00000000"},{"a":"MANA","f":"0.00000000","l":"0.00000000"},{"a":"PPT","f":"0.00000000","l":"0.00000000"},{"a":"OTN","f":"0.00000000","l":"0.00000000"},{"a":"CFD","f":"0.00000000","l":"0.00000000"},{"a":"RDN","f":"0.00000000","l":"0.00000000"},{"a":"GXS","f":"0.00000000","l":"0.00000000"},{"a":"AMB","f":"0.00000000","l":"0.00000000"},{"a":"ARN","f":"0.00000000","l":"0.00000000"},{"a":"BCPT","f":"0.00000000","l":"0.00000000"},{"a":"CND","f":"0.00000000","l":"0.00000000"},{"a":"GVT","f":"0.00000000","l":"0.00000000"},{"a":"POE","f":"0.00000000","l":"0.00000000"},{"a":"ALIS","f":"0.00000000","l":"0.00000000"},{"a":"BTS","f":"0.00000000","l":"0.00000000"},{"a":"FUEL","f":"0.00000000","l":"0.00000000"},{"a":"XZC","f":"0.00000000","l":"0.00000000"},{"a":"QSP","f":"0.00000000","l":"0.00000000"},{"a":"LSK","f":"0.00000000","l":"0.00000000"},{"a":"BCD","f":"0.00000000","l":"0.00000000"},{"a":"TNB","f":"0.00000000","l":"0.00000000"},{"a":"GRX","f":"0.00000000","l":"0.00000000"},{"a":"STAR","f":"0.00000000","l":"0.00000000"},{"a":"ADA","f":"0.00000000","l":"0.00000000"},{"a":"LEND","f":"0.00000000","l":"0.00000000"},{"a":"IFT","f":"0.00000000","l":"0.00000000"},{"a":"KICK","f":"0.00000000","l":"0.00000000"},{"a":"UKG","f":"0.00000000","l":"0.00000000"},{"a":"VOISE","f":"0.00000000","l":"0.00000000"},{"a":"XLM","f":"0.00000000","l":"0.00000000"},{"a":"CMT","f":"0.00000000","l":"0.00000000"},{"a":"WAVES","f":"0.00000000","l":"0.00000000"},{"a":"WABI","f":"0.00000000","l":"0.00000000"},{"a":"SBTC","f":"0.00000000","l":"0.00000000"},{"a":"BCX","f":"0.00000000","l":"0.00000000"},{"a":"GTO","f":"0.00000000","l":"0.00000000"},{"a":"ETF","f":"0.00000000","l":"0.00000000"},{"a":"ICX","f":"0.00000000","l":"0.00000000"},{"a":"OST","f":"0.00000000","l":"0.00000000"},{"a":"ELF","f":"0.00000000","l":"0.00000000"},{"a":"AION","f":"0.00000000","l":"0.00000000"},{"a":"WINGS","f":"0.00000000","l":"0.00000000"},{"a":"BRD","f":"0.00000000","l":"0.00000000"},{"a":"NEBL","f":"0.00000000","l":"0.00000000"},{"a":"NAV","f":"0.00000000","l":"0.00000000"},{"a":"VIBE","f":"0.00000000","l":"0.00000000"},{"a":"LUN","f":"0.00000000","l":"0.00000000"},{"a":"TRIG","f":"0.00000000","l":"0.00000000"},{"a":"APPC","f":"0.00000000","l":"0.00000000"},{"a":"CHAT","f":"0.00000000","l":"0.00000000"},{"a":"RLC","f":"0.00000000","l":"0.00000000"},{"a":"INS","f":"0.00000000","l":"0.00000000"},{"a":"PIVX","f":"0.00000000","l":"0.00000000"},{"a":"IOST","f":"0.00000000","l":"0.00000000"},{"a":"STEEM","f":"0.00000000","l":"0.00000000"},{"a":"NANO","f":"0.00000000","l":"0.00000000"},{"a":"AE","f":"0.00000000","l":"0.00000000"},{"a":"VIA","f":"0.00000000","l":"0.00000000"},{"a":"BLZ","f":"0.00000000","l":"0.00000000"},{"a":"SYS","f":"0.00000000","l":"0.00000000"},{"a":"RPX","f":"0.00000000","l":"0.00000000"},{"a":"NCASH","f":"0.00000000","l":"0.00000000"},{"a":"POA","f":"0.00000000","l":"0.00000000"},{"a":"ONT","f":"0.00040700","l":"0.00000000"},{"a":"ZIL","f":"0.00000000","l":"0.00000000"},{"a":"STORM","f":"0.00000000","l":"0.00000000"},{"a":"XEM","f":"0.00000000","l":"0.00000000"},{"a":"WAN","f":"0.00000000","l":"0.00000000"},{"a":"WPR","f":"0.00000000","l":"0.00000000"},{"a":"QLC","f":"0.00000000","l":"0.00000000"},{"a":"GRS","f":"0.00000000","l":"0.00000000"},{"a":"CLOAK","f":"0.00000000","l":"0.00000000"}]}`)

	cfg := jsoniter.Config{}
	cfg.DisallowUnknownFields = true
	//cfg.OnlyTaggedField = true
	//cfg.TagKey = "json"
	//cfg.UseNumber = true
	//cfg.IndentionStep
	extra.SetNamingStrategy(func(s string) string {
		log.Println("namingStrategy", s)
		return s
	})
	jsonapi := cfg.Froze()
	//log.Println("isValid", jsonapi.Valid(msg))

	var accInfo WsUserEventType

	err := jsonapi.Unmarshal(msg, &accInfo)
	log.Println(accInfo.EventType)
	log.Println("err", err)
	if err != nil {
		t.Fatal(err)
	}
}
